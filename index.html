<!DOCTYPE HTML>
<html lang="en">
    <head>
        <meta charset="UTF-8"/>
        <meta name="viewport" content="width=device-width, initial-scale=1"/>
        <meta name="theme-color" content="#252525"/>
        <title>Upupa Bird Ninja</title>
        <style>
            body {
                margin: 0;
                font-family: Inter, sans-serif;
                background-color: #252525;
                background-image: url(https://img.itch.zone/aW1nLzE3MjY2NjA0LmpwZw==/original/RcoHTc.jpg);
                background-repeat: repeat-x;
                background-position: center;
                background-attachment: fixed;
                color: #ffffff;
                display: flex;
                flex-direction: column;
                align-items: center;
                justify-content: center;
                min-height: 100vh;
            }
            .game_frame {
                width: 100%;
                max-width: 960px;
                height: calc(100vw * 0.625); /* Maintain 16:10 aspect ratio */
                max-height: 600px;
                background-color: #2b2b2b;
                position: relative;
                pointer-events: none; /* Disable interactions initially */
            }
            .fullscreen_btn {
                position: absolute;
                top: 10px;
                right: 10px;
                background: none;
                border: none;
                cursor: pointer;
            }
            .fullscreen_btn img {
                width: 24px;
                height: 24px;
            }
            .description {
                padding: 40px 20px; /* Increased padding for height */
                text-align: center;
                font-size: 1rem;
                background-color: #2b2b2b;
                color: #ffffff;
                width: 100%;
                max-width: 960px;
                box-sizing: border-box;
                position: relative;
            }
            .description h1 {
                margin: 0;
                font-size: 2rem;
                font-weight: bold;
                text-transform: uppercase;
            }
            .description img {
                margin-top: 20px;
                width: 100px;
                height: 65px;
                cursor: pointer;
            }
            .wallet-button {
                position: absolute;
                top: 10px;
                right: 10px;
                width: 100px;
                height: 30px;
                cursor: pointer;
            }
            .wallet-info {
                margin-top: 20px;
                color: #ffffff;
                font-size: 1rem;
            }
            .wallet-selector {
                margin-top: 20px;
                color: #ffffff;
                font-size: 1rem;
            }
            iframe {
                width: 100%;
                height: 100%;
                border: none;
            }
        </style>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/@solana/web3.js/1.75.0/web3.min.js"></script>
        <script>
            let walletConnected = false;
            let walletAddress = "";

            async function connectWallet(walletType) {
    try {
        if (walletType === "solana") {
            // Phantom Wallet for Solana
            if (!window.solana || !window.solana.isPhantom) {
                alert("Solana wallet not found. Please install Phantom Wallet.");
                return;
            }
            const response = await window.solana.connect();
            walletAddress = response.publicKey.toString();
            console.log("Connected to Solana via Phantom Wallet:", walletAddress);
        } else if (walletType === "okx" || walletType === "trust") {
            // OKX Wallet or Trust Wallet (Default EVM, needs to switch to Solana)
            if (!window.ethereum) {
                alert("EVM-compatible wallet not found. Please install OKX Wallet or Trust Wallet.");
                return;
            }
            // Request accounts from wallet
            const accounts = await window.ethereum.request({
                method: "eth_requestAccounts",
            });
            walletAddress = accounts[0];

            // Check if Solana network is supported (custom logic needed for OKX/Trust)
            const isSolanaSupported = await checkSolanaSupport(walletType);
            if (!isSolanaSupported) {
                alert("Your wallet does not support Solana. Please use Phantom Wallet.");
                return;
            }

            // If Solana supported, switch to Solana RPC
            await switchToSolanaNetwork(walletType);

            // Sign a message to confirm connection
            const message = "Sign this message to confirm wallet connection to Solana.";
            const signedMessage = await signMessage(walletType, message);
            console.log("Connected to Solana via OKX/Trust Wallet:", signedMessage);
        } else {
            alert("Unsupported wallet type.");
            return;
        }

        // Update UI
        document.getElementById("wallet-info").innerText = `Wallet Address: ${walletAddress}`;
        alert("Wallet connected and signature verified!");
        walletConnected = true;
        document.querySelector(".game_frame").style.pointerEvents = "auto";
    } catch (error) {
        console.error("Wallet connection failed:", error);
        alert("Failed to connect wallet. Please try again.");
    }
}

// Helper to check if the wallet supports Solana
async function checkSolanaSupport(walletType) {
    if (walletType === "okx") {
        return typeof window.okxwallet !== "undefined"; // Custom check for OKX
    }
    if (walletType === "trust") {
        return typeof window.ethereum !== "undefined"; // Trust Wallet uses Ethereum provider
    }
    return false;
}

// Helper to switch to Solana network
async function switchToSolanaNetwork(walletType) {
    const solanaRpcUrl = "https://api.mainnet-beta.solana.com"; // Replace with your Solana RPC URL
    if (walletType === "okx" || walletType === "trust") {
        // Switch RPC to Solana
        await window.ethereum.request({
            method: "wallet_addEthereumChain", // May require custom method for Solana
            params: [
                {
                    chainId: "0x1", // Solana's chain ID (use custom logic if needed)
                    rpcUrls: [solanaRpcUrl],
                    chainName: "Solana Mainnet",
                    nativeCurrency: {
                        name: "SOL",
                        symbol: "SOL",
                        decimals: 18,
                    },
                    blockExplorerUrls: ["https://explorer.solana.com"],
                },
            ],
        });
    }
}

// Helper to sign message
async function signMessage(walletType, message) {
    if (walletType === "okx" || walletType === "trust") {
        const signedMessage = await window.ethereum.request({
            method: "personal_sign",
            params: [message, walletAddress],
        });
        return signedMessage;
    }
}

        </script>
    </head>
    <body>
        <div class="game_frame">
            <button title="Enter fullscreen" class="fullscreen_btn">
                <img src="https://itch.io/static/images/enlarge.svg?1734309005" alt="Fullscreen"/>
            </button>
            <iframe
                src="https://html-classic.itch.zone/html/12246759/index.html"
                allow="autoplay; fullscreen *; geolocation; microphone; camera; midi; monetization; xr-spatial-tracking; gamepad; gyroscope; accelerometer; xr; cross-origin-isolated; web-share"
                allowfullscreen>
            </iframe>
        </div>
        <div class="description">
            <h1>GAME</h1>
            <p>
                Slice through hordes of enemies as you navigate Upupa the hoopoe through their final trial to bring light to the top of the tower and keep evil at bay for another generation. Upupa Bird Ninja is a fast-paced tough-as-talons adventure.
            </p>
            <p><em>Note: plays best with mouse or controller. Touch input not fully supported.</em></p>
            <a href="https://example.com" target="_blank">
                <img src="https://via.placeholder.com/100x65" alt="Link Image" />
            </a>
            <div class="wallet-selector">
                <label for="wallet-select">Choose Wallet:</label>
                <select id="wallet-select" onchange="connectWallet(this.value)">
                    <option value="">Select...</option>
                    <option value="solana">Solana</option>
                    <option value="okx">OKX</option>
                    <option value="trust">Trust Wallet</option>
                </select>
            </div>
            <div id="wallet-info" class="wallet-info"></div>
        </div>
    </body>
</html>
